<!DOCTYPE html>
<html lang=”en”>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>MailMask</title>
        <link rel="stylesheet" href="style.css">                
    </head>
    <body>
        <header>
            <div class="header-logo">
                <a href=""><img class="img-logo" src="img/logo_onWhite.png" alt="illustration logo"></a>
                <a href=""><img class="img-text-logo" src="img/logoText_simpleBlack.png" alt="mailmask logo"></a>    
            </div>
            
            <nav>
                <a class="nav-link" href="#howto">How It Works</a>                            
                <a class="nav-link" href="#support">Support</a>   
                <a class="nav-link" href="#cancel">Cancel Your MailMask</a> 
            </nav> 
        </header>
        
        <main>
            <section id="home"> <!-- HOME -->
                <div class="mail-overlay">
                    <img class="img-mail-backdrop" src="img/mail-backdrop.svg">
                </div>
                <div class="container">
                    <div class="content">
                        <div class="innerBox">                        
                            <div class="innerBox-text">                    
                                
                                <h1>Your email deserves <u>privacy</u>.</h1>
                            
                                                                        
                                <div class="catchphrase">
                                    <p>Generate a unique and random forwarding address so you can still recieve every email, newsletter etc. without sharing your personal address.</p>
                                </div>    
                                                    
                            </div>
                            <form action="">           
                                <input id="mail" placeholder="Enter your email here..." type="email" name="email" pattern="[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{1,63}$" required/>                                
                                <div class = "privacy-and-terms-checkbox">
                                    <input type="checkbox" id="checkbox" name="checkbox" required />
                                    <label>I agree with the <a href="#tandc">Terms & Conditions</a> and the <a href="#privacy">Privacy Policy</a>. </label>
                                </div>
                                <input type="submit" name="submitButton" id="submitButton" class="button-cta" value="Generate Mail">
                            </form>
                            <div class="alert alert-success" id="success" style="display:none"> Success Message</div>  
                        </div>                                            
                    </div>                    
                </div> 

                <div class="mail-overlay">
                    <img class="img-mail-overlay" src="img/mail.svg">
                </div>                    
            </section>

            <section id="howto">
                <div class="howto-div", id="howto"> <!-- HOW TO -->
                    <div class="howto-header">
                        <div class="howto-title"><h1>How It Works</h1></div>
                        <img class="illustration" src="img/illustration.png" alt="mail mask racoon">
                    </div>
                    <div class="howto-container", id="howto-container">
                        <div class="how-to-text" id="how-to-text">
                            <p>MailMask creates a unique and random email address for you. This way your real address is kept secret for the website or the app developer. This email address is uniquely fit to reroute incoming mails from the webpage to your address.</p>
                            <p>Your MailMask address consists out of a unique id and the domain ending "@mailmask.me".</p>
                            <p>Any messages sent to this address by the app or website developer are automatically forwarded to your personal email address.</p>
                            <p>MailMask <b>never</b> processes the content of your incoming mails. The data is stored only for forwarding and is deleted after the mail has been sent to your private email address.</p>                                                
                        </div>  
                    </div>                
                </div>
            </section>
            
            <section id="cancel"> <!-- CANCEL -->
                <div class="content-box">
                <div class="cancel-header">
                    <div class="cancel-title"><h1>Cancel Your MailMask</h1></div>
                    <div class="cancel-container", id="cancel-container">
                        <div class="cancel-text" id="cancel-text">
                            <p>If you wish to cancel or deactivate your MailMask forwarding address, simply paste the email in the following form and confirm your submission.</p>
                        </div>
                        <form action="">            
                            <input id="cancelMail" name="email" placeholder="Your MailMask address here..." type="email" pattern="[A-Za-z0-9._%+-]+@mailmask\.me" required></input>
                            <input type="submit" id="cancelButton" name="cancelButton" class="button-cta" value="Cancel Mail">
                        </form>  
                        <div class="alert alert-success" id="cancelSuccess" style="display:none"> Success Message</div>  
                    </div>
                </div>
            </div>
            </section> 

            <section id="support"> <!-- Support -->
                <div class="content-box">
                <div class="support-header">
                    <div class="support-title"><h1>Support MailMask</h1></div>
                    <div class="support-img"><img src="img/support-img.svg" alt="MailMask racoon playing with a bitcoin - illustration"></div>
                    <div class="support-container", id="sub-container">
                        <div class="sub-text" id="sub-text">
                            <p>Please feel free to donate in case you enjoy my service. MailMask currently runs without ads and does not make any revenue other than donations.</p>
                            <p>Your donations will be used to cover the costs of servers, domains and work for the project.</p>
                            <p>Currently, MailMask supports the following ways of payments. I consider every donation as private and anonymous.</p>
                            <div class="support-list">
                                <label class="support-row-label" for="BTC"><strong>Bitcoin (BTC)</strong></label>
                                <input class="support-row-input" type="text" value="1C3MVvvJwfEiS5KQmZzJkiVq7obYi2zRqb" readonly>
                                <br>
                                <label class="support-row-label" for="ETH"><strong>Ethereum (ETH)</strong></label>
                                <input class="support-row-input" type="text" value="0x1DdD9c188aaf9198b664CeBce9a9cD03E75FdD49" readonly>
                                <br>
                                <label class="support-row-label" for="ETH"><strong>ZCash (ZEC)</strong></label>
                                <input class="support-row-input" type="text" value="t1Sv6rSRchWUXkWNz7PkeYixTs9M2aAs4wX" readonly>
                            </div>
                        </div>                        
                    </div>
                </div>
            </div>
            </section> 

            <section id="tandc"> <!-- Terms and Conditions -->
                <div class="content-box">
                <div class="tandc-header">
                    <div class="tandc-title"><h1>Terms and Conditions</h1></div>
                    <div class="tandc-container", id="sub-container">
                        <div class="sub-text" id="sub-text">
                            <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
                        </div>                        
                    </div>
                </div>
            </div>
            </section> 

            <section id="privacy"> <!-- Terms and Conditions -->
                <div class="content-box">
                <div class="privacy-header">
                    <div class="privacy-title"><h1>Privacy Policy</h1></div>
                    <div class="privacy-container", id="sub-container">
                        <div class="sub-text" id="sub-text">
                            <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
                        </div>                        
                    </div>
                </div>
            </div>
            </section> 
        </main>        

        <div class="imprint", id="imprint"> <!-- IMPRINT -->
            <button onclick="document.getElementById('imprint-modal').style.clipPath='inset(-20% -20% -20% -20% round 2rem)'" class="imprint-button">
                i
            </button>

            <div id="imprint-modal" class="imprint-modal">
                <div class="imprint-modal-content">
                  <div class="imprint-container-header"> 
                    <span onclick="document.getElementById('imprint-modal').style.clipPath='inset(100% 0% 0% 100% round 2rem)'">&times;</span>
                    <h2>Imprint</h2>
                  </div>
                  <div class="imprint-container">
                    <p>Made with ♥ by Hendrik Schuette</p>
                    <p>Angaben gemäß § 5 TMG: Hendrik Schuette Turmstraße 54, 10551 Berlin
                        Kontakt: hendrik.schuette@tutanota.com</p>
                  </div>                      
                </div>
              </div>
            </div>
        </div>
        
        <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.js"></script>
                
        <script type="text/javascript">
            var API_URL = "https://423ghva5nf.execute-api.eu-west-1.amazonaws.com/prod/mails";
            
            $("#submitButton").on('click', function() {
                if (!$("#mail").val()) {
                    console.log("Error - invalid request. No email input.") 
                } else {
                    if ($("#checkbox").prop('checked') == false) {
                        console.log("Error - invalid request. Checkbox not checked.")
                    } else {
                        $.ajax({
                        type: "POST",
                        url: API_URL,
                        data: JSON.stringify({"forwardingAddress": $("#mail").val()}),
                        contentType: "application/JSON",

                        success: function(data) {
                            $("#success").show(),
                            setTimeout(function() { $("#success").hide(); }, 5000)
                            $("#mail").val("")
                        }
                    }); 
                    return false;
                    }
                }                    
            });

            function validateEmail(email) {
                var pattern = new RegExp(/[+a-zA-Z0-9._-]+@mailmask+\.me/gmi);
                return pattern.test( email );
            }

            $("#cancelButton").on('click', function() {                
                if (!$("#cancelMail").val()) {
                    console.log("Error - invalid request. No email input.") 
                } else {
                    if (!validateEmail($("#cancelMail").val())) {
                    console.log("Error - invalid request. Wrong email format.")
                    console.log($("#cancelMail"))
                } else {
                    var mailID = $("#cancelMail").val().toString().slice(0,8).toLowerCase()                    

                    console.log("Canceling was a success!") 
                        $.ajax({
                        type: "DELETE",
                        url: API_URL,
                        data: JSON.stringify({"mailID": mailID}),
                        contentType: "application/JSON",

                        success: function(data) {
                            $("#cancelSuccess").show(),
                            setTimeout(function() { $("#cancelSuccess").hide(); }, 5000)
                            $("#cancelMail").val("")
                        }
                    }); 
                    return false;
                    }
                }
            });

            function getUrlVars() {
                var vars = {};
                var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
                    vars[key] = value;
                });
                return vars;
            }

            function getUrlParam(parameter, defaultvalue){
                var urlparameter = defaultvalue;
                if(window.location.href.indexOf(parameter) > -1){
                    urlparameter = getUrlVars()[parameter];
                    }
                return urlparameter;
            };

            window.onload = function() {
                var cancelMail = decodeURI(getUrlParam("cancelMail", ""));

                cancelMail = cancelMail.replace("%40", "@")
                cancelMail = cancelMail.replace("#cancel", "")
                $("#cancelMail").val(cancelMail)

            };

            
        </script>
    </body>
</html>